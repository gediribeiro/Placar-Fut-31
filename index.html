<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="Sistema de placar profissional">
<meta name="theme-color" content="#1a1a2e">
<meta name="apple-mobile-web-app-capable" content="yes">
<!-- Manifest simplificado e correto -->
<link rel="manifest" href="./manifest.json">
<title>Placar Pro</title>
<style>
:root {
  --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --bg-dark: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  --bg-card: rgba(255, 255, 255, 0.95);
  --bg-card-dark: rgba(30, 30, 46, 0.95);
  --text: #1a1a2e;
  --text-dark: #e4e6eb;
  --text-sec: #6c757d;
  --text-sec-dark: #8b8d94;
  --green: #0fb858;
  --red: #ff4757;
  --yellow: #ffa502;
  --blue: #3742fa;
  --border: rgba(0, 0, 0, 0.1);
  --border-dark: rgba(255, 255, 255, 0.1);
  --shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  --field: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h60v60H0z' fill='%230fb858' fill-opacity='0.03'/%3E%3Cpath d='M30 0v60M0 30h60' stroke='%230fb858' stroke-opacity='0.05' stroke-width='0.5'/%3E%3C/svg%3E")
}

[data-theme="dark"] {
  --bg-gradient: var(--bg-dark);
  --bg-card: var(--bg-card-dark);
  --text: var(--text-dark);
  --text-sec: var(--text-sec-dark);
  --border: var(--border-dark);
  --shadow: 0 4px 16px rgba(0, 0, 0, 0.4)
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
  background: #f8f9fa;
  color: var(--text);
  overflow-x: hidden;
  transition: background 0.3s
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--field);
  opacity: 1;
  pointer-events: none;
  z-index: 0
}

/* Toast notifications */
.toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-card);
  color: var(--text);
  padding: 12px 24px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  z-index: 9999;
  animation: slideDown 0.3s ease;
  font-weight: 600;
  max-width: 90%;
  text-align: center;
}

.toast-success {
  border-left: 4px solid var(--green);
}

.toast-error {
  border-left: 4px solid var(--red);
}

.toast-warning {
  border-left: 4px solid var(--yellow);
}

@keyframes slideDown {
  from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

/* Resto do CSS permanece igual */
header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg-gradient);
  backdrop-filter: blur(10px);
  padding: 16px 20px;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  justify-content: space-between
}

.header-content {
  display: flex;
  align-items: center;
  gap: 12px
}

.header-logo {
  font-size: 32px;
  animation: rotate 20s linear infinite
}

@keyframes rotate {
  from { transform: rotate(0deg) }
  to { transform: rotate(360deg) }
}

.header-title {
  font-size: 22px;
  font-weight: 800;
  color: white;
  letter-spacing: -0.5px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2)
}

.theme-toggle {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  border-radius: 20px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.3s
}

.theme-toggle:active {
  transform: scale(0.9) rotate(180deg)
}

.tabs {
  display: flex;
  background: var(--bg-card);
  overflow-x: auto;
  scrollbar-width: none;
  box-shadow: var(--shadow);
  position: relative;
  z-index: 10
}

.tabs::-webkit-scrollbar {
  display: none
}

.tabs button {
  flex: 1;
  min-width: 90px;
  padding: 14px 20px;
  border: none;
  background: transparent;
  font-size: 15px;
  font-weight: 600;
  color: var(--text-sec);
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  white-space: nowrap
}

.tabs button::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%) scaleX(0);
  width: 80%;
  height: 3px;
  background: var(--green);
  border-radius: 3px 3px 0 0;
  transition: transform 0.3s
}

.tabs button.active {
  color: var(--green)
}

.tabs button.active::after {
  transform: translateX(-50%) scaleX(1)
}

section {
  display: none;
  padding: 16px;
  padding-bottom: 80px;
  animation: fadeIn 0.4s;
  position: relative;
  z-index: 1
}

section.active {
  display: block
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px) }
  to { opacity: 1; transform: translateY(0) }
}

.card {
  background: var(--bg-card);
  backdrop-filter: blur(10px);
  padding: 20px;
  border-radius: 16px;
  margin: 12px 0;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  transition: all 0.3s;
  position: relative;
  overflow: hidden
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--green), var(--blue));
  opacity: 0;
  transition: opacity 0.3s
}

.card:hover::before {
  opacity: 1
}

.placar-container {
  position: relative;
  overflow: hidden;
  border-radius: 20px
}

.placar-container::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  right: -50%;
  bottom: -50%;
  background: repeating-linear-gradient(90deg, rgba(15, 184, 88, 0.03) 0px, rgba(15, 184, 88, 0.03) 50px, rgba(15, 184, 88, 0.05) 50px, rgba(15, 184, 88, 0.05) 100px);
  animation: slideField 40s linear infinite;
  pointer-events: none
}

@keyframes slideField {
  from { transform: translateX(0) }
  to { transform: translateX(100px) }
}

.placar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  position: relative;
  z-index: 2
}

.nome-time {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  padding: 8px 12px;
  background: rgba(15, 184, 88, 0.1);
  border-radius: 8px;
  backdrop-filter: blur(5px)
}

.nome-time.left {
  justify-content: flex-start
}

.nome-time.right {
  justify-content: flex-end;
  flex-direction: row-reverse
}

.btn-edit {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  opacity: 0.6;
  transition: all 0.2s;
  padding: 4px
}

.btn-edit:active {
  opacity: 1;
  transform: scale(1.2)
}

.placar {
  text-align: center;
  font-size: 64px;
  font-weight: 900;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 24px;
  padding: 24px 0;
  position: relative;
  z-index: 2;
  font-variant-numeric: tabular-nums
}

.placar.gol-animation {
  animation: golPulse 0.6s cubic-bezier(0.4, 0, 0.2, 1)
}

@keyframes golPulse {
  0%, 100% { transform: scale(1) }
  25% { transform: scale(1.15); color: var(--green) }
  50% { transform: scale(0.95) }
  75% { transform: scale(1.05) }
}

.placar-time {
  display: flex;
  align-items: center;
  gap: 16px
}

.placar span {
  min-width: 80px;
  text-align: center
}

.botoes-verticais {
  display: flex;
  flex-direction: column;
  gap: 8px
}

.btn-mais, .btn-menos, .btn-falta {
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  box-shadow: var(--shadow);
  position: relative;
  overflow: hidden
}

.btn-mais::before, .btn-menos::before, .btn-falta::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.4s, height 0.4s
}

.btn-mais:active::before, .btn-menos:active::before, .btn-falta:active::before {
  width: 100px;
  height: 100px
}

.btn-mais {
  background: linear-gradient(135deg, #0fb858, #0ea04d);
  color: white;
  width: 56px;
  height: 70px;
  font-size: 36px
}

.btn-menos {
  background: linear-gradient(135deg, #ff4757, #e63946);
  color: white;
  width: 56px;
  height: 46px;
  font-size: 24px
}

.btn-falta {
  background: linear-gradient(135deg, #ffa502, #ff8c00);
  color: white;
  width: 56px;
  height: 46px;
  font-size: 20px
}

.btn-mais:active, .btn-menos:active, .btn-falta:active {
  transform: scale(0.92)
}

.placar .vs {
  font-size: 40px;
  color: var(--text-sec);
  font-weight: 400;
  opacity: 0.5
}

.tempo-container {
  text-align: center;
  margin: 20px 0;
  position: relative;
  z-index: 2
}

#tempo {
  font-size: 32px;
  font-weight: 700;
  color: var(--text);
  display: inline-block;
  min-width: 120px;
  cursor: pointer;
  padding: 12px 24px;
  border-radius: 12px;
  background: linear-gradient(135deg, rgba(15, 184, 88, 0.1), rgba(15, 184, 88, 0.05));
  border: 2px solid rgba(15, 184, 88, 0.2);
  user-select: none;
  transition: all 0.3s;
  font-variant-numeric: tabular-nums
}

#tempo:active {
  transform: scale(0.95)
}

#tempo.tempo-pausado {
  color: var(--red);
  border-color: rgba(255, 71, 87, 0.3);
  background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
  animation: pulse 1.5s ease-in-out infinite
}

@keyframes pulse {
  0%, 100% { opacity: 1 }
  50% { opacity: 0.6 }
}

.contador-faltas {
  display: flex;
  justify-content: space-around;
  gap: 20px;
  margin: 16px 0;
  font-size: 14px;
  color: var(--text-sec);
  position: relative;
  z-index: 2
}

.falta-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: rgba(255, 165, 2, 0.1);
  border-radius: 20px;
  border: 1px solid rgba(255, 165, 2, 0.2)
}

.falta-numero {
  font-size: 18px;
  font-weight: 700;
  color: var(--yellow);
  min-width: 24px;
  text-align: center
}

.actions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap
}

.actions button {
  flex: 1;
  min-width: 100px;
  padding: 16px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: var(--shadow);
  position: relative;
  overflow: hidden
}

.actions button::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.4s, height 0.4s
}

.actions button:active::before {
  width: 200px;
  height: 200px
}

.actions button:active {
  transform: scale(0.95)
}

.green {
  background: linear-gradient(135deg, #0fb858, #0ea04d);
  color: white
}

.yellow {
  background: linear-gradient(135deg, #ffa502, #ff8c00);
  color: white
}

.red {
  background: linear-gradient(135deg, #ff4757, #e63946);
  color: white
}

.blue {
  background: linear-gradient(135deg, #3742fa, #2f3ded);
  color: white
}

.btn-animating-green {
  animation: btnPulseGreen 0.6s
}

.btn-animating-red {
  animation: btnPulseRed 0.6s
}

@keyframes btnPulseGreen {
  0%, 100% { transform: scale(1) }
  50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(15, 184, 88, 0.5) }
}

@keyframes btnPulseRed {
  0%, 100% { transform: scale(1) }
  50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 71, 87, 0.5) }
}

input, select {
  padding: 14px 16px;
  margin: 8px 0;
  width: 100%;
  font-size: 16px;
  border: 2px solid var(--border);
  border-radius: 12px;
  background: var(--bg-card);
  color: var(--text);
  transition: all 0.3s
}

input:focus, select:focus {
  outline: none;
  border-color: var(--green);
  box-shadow: 0 0 0 4px rgba(15, 184, 88, 0.1)
}

ul {
  list-style: none;
  padding: 0
}

li {
  background: var(--bg-card);
  padding: 16px;
  margin: 10px 0;
  border-radius: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  transition: all 0.3s
}

li:hover {
  transform: translateX(4px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15)
}

li button {
  border: none;
  background: none;
  font-size: 22px;
  cursor: pointer;
  padding: 8px;
  transition: transform 0.2s
}

li button:active {
  transform: scale(1.3)
}

.historico-item {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 16px;
  margin: 12px 0;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  cursor: pointer;
  transition: all 0.3s
}

.historico-item:active {
  transform: scale(0.98)
}

.historico-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px
}

.historico-data {
  font-size: 13px;
  color: var(--text-sec);
  font-weight: 500
}

.historico-placar {
  font-size: 24px;
  font-weight: 800;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 12px
}

.historico-placar .vs {
  font-size: 16px;
  color: var(--text-sec);
  font-weight: 400
}

.historico-info {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 8px;
  padding-top: 12px;
  border-top: 1px solid var(--border)
}

.historico-craque {
  font-size: 13px;
  color: var(--text-sec)
}

.historico-craque strong {
  color: var(--green);
  font-weight: 700
}

.expand-icon {
  font-size: 18px;
  color: var(--text-sec);
  transition: transform 0.3s
}

.historico-item.expanded .expand-icon {
  transform: rotate(180deg)
}

.historico-details {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1)
}

.historico-item.expanded .historico-details {
  max-height: 500px;
  margin-top: 16px
}

.historico-gols {
  background: rgba(15, 184, 88, 0.05);
  padding: 12px;
  border-radius: 8px;
  margin-top: 8px
}

.historico-gols h5 {
  margin: 0 0 8px 0;
  font-size: 13px;
  color: var(--text-sec);
  text-transform: uppercase;
  letter-spacing: 0.5px
}

.gol-item {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  font-size: 14px
}

.popup-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(8px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s
}

.popup-overlay.show {
  display: flex
}

.popup-content {
  background: var(--bg-card);
  padding: 24px;
  border-radius: 20px;
  max-width: 90%;
  max-height: 80%;
  overflow-y: auto;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--border);
  animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1)
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px) }
  to { opacity: 1; transform: translateY(0) }
}

.popup-content h3 {
  margin-top: 0;
  margin-bottom: 20px;
  color: var(--text);
  font-size: 20px;
  font-weight: 700
}

.popup-jogadores {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
  margin: 20px 0
}

.popup-jogadores button {
  padding: 20px 12px;
  border: 2px solid var(--green);
  background: var(--bg-card);
  color: var(--green);
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  min-height: 60px
}

.popup-jogadores button:active {
  background: var(--green);
  color: white;
  transform: scale(0.95)
}

.popup-gols {
  display: flex;
  flex-direction: column;
  gap: 10px
}

.popup-gols button {
  padding: 16px;
  border: none;
  background: rgba(255, 71, 87, 0.1);
  border-radius: 12px;
  cursor: pointer;
  text-align: left;
  font-size: 15px;
  color: var(--text);
  border: 1px solid rgba(255, 71, 87, 0.2);
  transition: all 0.2s
}

.popup-gols button:active {
  background: var(--red);
  color: white;
  transform: scale(0.98)
}

.btn-fechar, .btn-confirmar {
  margin-top: 20px;
  padding: 16px 24px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  width: 100%;
  font-size: 16px;
  font-weight: 700;
  transition: all 0.2s
}

.btn-fechar {
  background: var(--text-sec);
  color: white
}

.btn-confirmar {
  background: linear-gradient(135deg, #0fb858, #0ea04d);
  color: white
}

.game-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(10px);
  z-index: 2000;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.4s
}

.game-overlay.show {
  display: flex
}

.game-overlay-content {
  text-align: center;
  animation: zoomIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)
}

@keyframes zoomIn {
  from { opacity: 0; transform: scale(0.5) }
  to { opacity: 1; transform: scale(1) }
}

.game-overlay-text {
  font-size: 48px;
  font-weight: 900;
  color: white;
  text-transform: uppercase;
  letter-spacing: 3px;
  text-shadow: 0 4px 20px rgba(15, 184, 88, 0.8);
  margin-bottom: 20px
}

.game-overlay-icon {
  font-size: 80px;
  animation: bounce 1s ease infinite
}

@keyframes bounce {
  0%, 100% { transform: translateY(0) }
  50% { transform: translateY(-20px) }
}

.stat-card {
  background: var(--bg-card);
  padding: 16px;
  border-radius: 12px;
  margin: 12px 0;
  border-left: 4px solid var(--green);
  box-shadow: var(--shadow);
  transition: all 0.3s
}

.stat-card:hover {
  transform: translateX(4px)
}

.stat-card h4 {
  margin: 0 0 12px 0;
  color: var(--text);
  font-size: 16px;
  font-weight: 700
}

.stat-row {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid var(--border)
}

.stat-row:last-child {
  border-bottom: none
}

.stat-label {
  color: var(--text-sec);
  font-size: 14px
}

.stat-value {
  font-weight: 700;
  color: var(--text);
  font-size: 14px
}

.badge {
  background: var(--green);
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
  margin-left: 8px
}

.badge.warning {
  background: var(--yellow)
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--border);
  border-radius: 10px;
  overflow: hidden;
  margin-top: 8px
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--green), var(--blue));
  border-radius: 10px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1)
}

.comparacao-container {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 16px;
  align-items: center;
  margin: 20px 0
}

.jogador-compare {
  background: rgba(15, 184, 88, 0.05);
  padding: 20px;
  border-radius: 16px;
  text-align: center;
  border: 2px solid rgba(15, 184, 88, 0.2)
}

.jogador-compare h3 {
  margin: 0 0 16px 0;
  font-size: 18px;
  color: var(--text)
}

.compare-vs {
  font-size: 28px;
  font-weight: 900;
  color: var(--text-sec)
}

.compare-stat {
  margin: 12px 0
}

.compare-stat-label {
  font-size: 12px;
  color: var(--text-sec);
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px
}

.compare-stat-value {
  font-size: 24px;
  font-weight: 800;
  color: var(--green)
}

.grafico-container {
  background: var(--bg-card);
  padding: 20px;
  border-radius: 16px;
  margin: 16px 0;
  overflow-x: auto;
  box-shadow: var(--shadow)
}

.grafico-container h4 {
  margin: 0 0 16px 0;
  color: var(--text);
  font-size: 16px;
  font-weight: 700
}

svg {
  max-width: 100%;
  height: auto
}

#installBtn {
  display: none;
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #0fb858, #0ea04d);
  color: white;
  border: none;
  padding: 16px 32px;
  border-radius: 30px;
  font-size: 16px;
  font-weight: 700;
  box-shadow: 0 8px 24px rgba(15, 184, 88, 0.4);
  cursor: pointer;
  z-index: 1000;
  animation: bounceIn 1s, float 3s ease-in-out infinite
}

@keyframes bounceIn {
  0% { transform: translateX(-50%) scale(0) }
  50% { transform: translateX(-50%) scale(1.1) }
  100% { transform: translateX(-50%) scale(1) }
}

@keyframes float {
  0%, 100% { transform: translateX(-50%) translateY(0) }
  50% { transform: translateX(-50%) translateY(-10px) }
}

#installBtn:active {
  transform: translateX(-50%) scale(0.95)
}

#undoBtn {
  display: none;
  position: fixed;
  bottom: 90px;
  right: 24px;
  background: var(--yellow);
  color: white;
  border: none;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  font-size: 24px;
  box-shadow: 0 4px 12px rgba(255, 165, 2, 0.4);
  cursor: pointer;
  z-index: 999;
  animation: slideInRight 0.4s;
  transition: all 0.2s
}

@keyframes slideInRight {
  from { transform: translateX(100px); opacity: 0 }
  to { transform: translateX(0); opacity: 1 }
}

#undoBtn:active {
  transform: scale(0.9)
}

.hidden {
  display: none !important
}

@media (max-width: 480px) {
  .placar { font-size: 52px; gap: 16px }
  .btn-mais { width: 50px; height: 64px; font-size: 32px }
  .btn-menos, .btn-falta { width: 50px; height: 42px }
  .popup-jogadores { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)) }
}

@media (orientation: landscape) and (max-height: 500px) {
  .placar { font-size: 48px; padding: 12px 0 }
  header { padding: 12px 20px }
  .card { padding: 16px }
}
</style>
</head>
<body>
<header>
<div class="header-content">
<div class="header-logo">‚öΩ</div>
<div class="header-title">Placar Fut 31</div>
</div>
<button class="theme-toggle" onclick="PlacarApp.toggleTheme()" title="Alternar tema">üåì</button>
</header>
<div class="tabs">
<button class="active" onclick="PlacarApp.trocarTab('jogo', this)">Jogo</button>
<button onclick="PlacarApp.trocarTab('jogadores', this)">Jogadores</button>
<button onclick="PlacarApp.trocarTab('ranking', this)">Ranking</button>
<button onclick="PlacarApp.trocarTab('historico', this)">Hist√≥rico</button>
<button onclick="PlacarApp.trocarTab('stats', this)">Stats</button>
<button onclick="PlacarApp.trocarTab('comparar', this)">Comparar</button>
</div>
<section id="jogo" class="active">
<div class="card placar-container">
<div class="placar-header">
<div class="nome-time left">
<span id="nomeTimeA">Time A</span>
<button class="btn-edit" onclick="PlacarApp.editarNomeTime('A')">‚úèÔ∏è</button>
</div>
<div class="nome-time right">
<button class="btn-edit" onclick="PlacarApp.editarNomeTime('B')">‚úèÔ∏è</button>
<span id="nomeTimeB">Time B</span>
</div>
</div>
<div id="placarDiv" class="placar">
<div class="placar-time">
<div class="botoes-verticais">
<button class="btn-mais" onclick="PlacarApp.aumentarGol('A')">+</button>
<button class="btn-menos" onclick="PlacarApp.diminuirGol('A')">‚àí</button>
<button class="btn-falta" onclick="PlacarApp.registrarFalta('A')">‚ö†Ô∏è</button>
</div>
<span id="placarA">0</span>
</div>
<span class="vs">√ó</span>
<div class="placar-time">
<span id="placarB">0</span>
<div class="botoes-verticais">
<button class="btn-mais" onclick="PlacarApp.aumentarGol('B')">+</button>
<button class="btn-menos" onclick="PlacarApp.diminuirGol('B')">‚àí</button>
<button class="btn-falta" onclick="PlacarApp.registrarFalta('B')">‚ö†Ô∏è</button>
</div>
</div>
</div>
<div class="tempo-container">
<div id="tempo" onclick="PlacarApp.togglePause()">00:00</div>
</div>
<div class="contador-faltas">
<div class="falta-item">
<span id="nomeFaltaA">Time A</span>: 
<span class="falta-numero" id="faltasA">0</span> faltas
</div>
<div class="falta-item">
<span id="nomeFaltaB">Time B</span>: 
<span class="falta-numero" id="faltasB">0</span> faltas
</div>
</div>
</div>
<div class="card actions">
<button id="btnIniciar" class="green" onclick="PlacarApp.iniciar()">‚ñ∂ Iniciar</button>
<button class="yellow" onclick="PlacarApp.resetar()">üîÑ Reset</button>
<button id="btnFim" class="red" onclick="PlacarApp.fim()">‚õî Fim</button>
</div>
<h3 id="tituloGols" class="hidden">üìä Vis√£o Geral da Partida</h3>
<ul id="listaGols"></ul>
</section>
<section id="jogadores">
<div class="card">
<input id="novoJogador" placeholder="Nome do jogador" maxlength="20">
<button class="green" onclick="PlacarApp.addJogador()" style="margin-top:8px;padding:20px;font-size:18px">‚ûï Adicionar Jogador</button>
</div>
<ul id="listaJogadores"></ul>
</section>
<section id="ranking">
<div class="card">
<h3>üèÜ Ranking de Gols - Geral</h3>
<ul id="listaRankingGeral"></ul>
</div>
<div class="card">
<h3>üìÖ Ranking de Gols - M√™s</h3>
<ul id="listaRankingMes"></ul>
</div>
<div class="card">
<h3>‚ö†Ô∏è Ranking de Faltas</h3>
<ul id="listaRankingFaltas"></ul>
</div>
</section>
<section id="historico">
<button class="red" onclick="PlacarApp.limparHistorico()" style="width:100%;margin-bottom:16px;padding:18px">üóëÔ∏è Limpar Hist√≥rico</button>
<div id="listaHistorico"></div>
</section>
<section id="stats">
<div class="card">
<h3>üìä Estat√≠sticas Gerais</h3>
<div id="statsGerais"></div>
</div>
<div class="card">
<h3>üî• √öltimas 5 Partidas</h3>
<div id="statsRecentes"></div>
</div>
<div class="card">
<h3>üë§ Por Jogador</h3>
<div id="statsPorJogador"></div>
</div>
<div class="grafico-container">
<h4>üìà Evolu√ß√£o de Gols</h4>
<div id="graficoEvolucao"></div>
</div>
</section>
<section id="comparar">
<div class="card">
<h3>‚öñÔ∏è Comparar Jogadores</h3>
<select id="jogador1"><option value="">Selecione jogador 1</option></select>
<select id="jogador2"><option value="">Selecione jogador 2</option></select>
<button class="blue" onclick="PlacarApp.compararJogadores()" style="margin-top:8px;padding:18px">‚öñÔ∏è Comparar</button>
</div>
<div id="resultadoComparacao"></div>
</section>
<div id="popupJogador" class="popup-overlay" onclick="PlacarApp.fecharPopup(event)">
<div class="popup-content" onclick="event.stopPropagation()">
<h3 id="popupTitulo">‚öΩ Quem fez o gol?</h3>
<div id="popupJogadores" class="popup-jogadores"></div>
<button class="btn-fechar" onclick="PlacarApp.fecharPopup()">‚úñ Cancelar</button>
</div>
</div>
<div id="popupFalta" class="popup-overlay" onclick="PlacarApp.fecharPopupFalta(event)">
<div class="popup-content" onclick="event.stopPropagation()">
<h3 id="popupTituloFalta">‚ö†Ô∏è Quem fez a falta?</h3>
<div id="popupJogadoresFalta" class="popup-jogadores"></div>
<button class="btn-fechar" onclick="PlacarApp.fecharPopupFalta()">‚úñ Cancelar</button>
</div>
</div>
<div id="popupRemover" class="popup-overlay" onclick="PlacarApp.fecharPopupRemover(event)">
<div class="popup-content" onclick="event.stopPropagation()">
<h3>üóëÔ∏è Remover qual gol?</h3>
<div id="popupGols" class="popup-gols"></div>
<button class="btn-fechar" onclick="PlacarApp.fecharPopupRemover()">‚úñ Cancelar</button>
</div>
</div>
<div id="popupNomeTime" class="popup-overlay" onclick="PlacarApp.fecharPopupNome(event)">
<div class="popup-content" onclick="event.stopPropagation()">
<h3 id="popupTituloNome">‚úèÔ∏è Editar Nome do Time</h3>
<input id="inputNomeTime" type="text" placeholder="Nome do time" maxlength="20">
<button class="btn-confirmar" onclick="PlacarApp.salvarNomeTime()">‚úì Confirmar</button>
<button class="btn-fechar" onclick="PlacarApp.fecharPopupNome()">‚úñ Cancelar</button>
</div>
</div>
<div id="gameOverlay" class="game-overlay">
<div class="game-overlay-content">
<div class="game-overlay-icon" id="overlayIcon">‚öΩ</div>
<div class="game-overlay-text" id="overlayText">IN√çCIO DE JOGO</div>
</div>
</div>
<button id="installBtn" onclick="PlacarApp.instalarApp()">üì± Instalar App</button>
<button id="undoBtn" onclick="PlacarApp.desfazer()">‚Ü∂</button>
<script>
// ============================================
// ARQUIVO: placar-app.js (C√≥digo JavaScript Corrigido)
// ============================================

const PlacarApp = (function() {
  // Estado centralizado da aplica√ß√£o
  const state = {
    jogadores: JSON.parse(localStorage.getItem("jogadores")) || [],
    historicaGols: [],
    historicaFaltas: [],
    ultimaAcao: null,
    placar: { A: 0, B: 0 },
    faltas: { A: 0, B: 0 },
    partida: null,
    timer: null,
    segundos: 0,
    pausado: false,
    timeAtual: null,
    timeAtualFalta: null,
    nomeA: "Time A",
    nomeB: "Time B",
    timeEditando: null,
    deferredPrompt: null,
    undoTimer: null
  };

  // ============================================
  // FUN√á√ïES DE UTILIDADE
  // ============================================

  // Fun√ß√£o para escapar HTML (preven√ß√£o XSS)
  function escapeHTML(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // Fun√ß√£o para mostrar toast/notifica√ß√£o
  function showToast(message, type = 'info', duration = 3000) {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(-50%) translateY(-20px)';
      setTimeout(() => toast.remove(), 300);
    }, duration);
    
    // Vibra√ß√£o t√°til se dispon√≠vel
    if (navigator.vibrate) {
      navigator.vibrate(30);
    }
  }

  // Fun√ß√£o para confirmar a√ß√µes
  function confirmAction(message) {
    return new Promise((resolve) => {
      if (window.confirm(message)) {
        resolve(true);
      } else {
        resolve(false);
      }
    });
  }

  // ============================================
  // FUN√á√ïES DE GEST√ÉO DO JOGO
  // ============================================

  function toggleTheme() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute("data-theme");
    const newTheme = currentTheme === "dark" ? "light" : "dark";
    
    html.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
    
    if (navigator.vibrate) navigator.vibrate(10);
    showToast(`Tema ${newTheme === 'dark' ? 'escuro' : 'claro'} ativado`, 'success');
  }

  function carregarTema() {
    const savedTheme = localStorage.getItem("theme") || "light";
    document.documentElement.setAttribute("data-theme", savedTheme);
  }

  function trocarTab(tabId, button) {
    // Esconder todas as se√ß√µes
    document.querySelectorAll("section").forEach(section => {
      section.classList.remove("active");
    });
    
    // Remover classe active de todos os bot√µes
    document.querySelectorAll(".tabs button").forEach(btn => {
      btn.classList.remove("active");
    });
    
    // Mostrar se√ß√£o selecionada
    document.getElementById(tabId).classList.add("active");
    button.classList.add("active");
    
    // Executar fun√ß√µes espec√≠ficas da tab
    switch(tabId) {
      case 'ranking':
        ranking();
        break;
      case 'historico':
        historico();
        break;
      case 'stats':
        estatisticas();
        break;
      case 'comparar':
        carregarComparacao();
        break;
    }
    
    // Feedback t√°til
    if (navigator.vibrate) navigator.vibrate(5);
  }

  // ============================================
  // GEST√ÉO DE JOGADORES
  // ============================================

  function addJogador() {
    const input = document.getElementById('novoJogador');
    const nome = input.value.trim();
    
    // Valida√ß√µes
    if (!nome) {
      showToast('Digite um nome para o jogador', 'error');
      return;
    }
    
    if (nome.length > 20) {
      showToast('Nome muito longo (m√°x: 20 caracteres)', 'error');
      return;
    }
    
    // Validar caracteres (permitir letras, n√∫meros, espa√ßos e acentos)
    if (!/^[a-zA-Z√Ä-√ø0-9\s]+$/.test(nome)) {
      showToast('Use apenas letras, n√∫meros e espa√ßos', 'error');
      return;
    }
    
    // Verificar se j√° existe
    if (state.jogadores.includes(nome)) {
      showToast('Jogador j√° existe!', 'warning');
      return;
    }
    
    // Adicionar jogador
    state.jogadores.push(nome);
    localStorage.setItem("jogadores", JSON.stringify(state.jogadores));
    
    // Limpar input e renderizar
    input.value = '';
    renderJogadores();
    
    // Feedback
    if (navigator.vibrate) navigator.vibrate(10);
    showToast(`${nome} adicionado!`, 'success');
  }

  async function removerJogador(index) {
    const nome = state.jogadores[index];
    
    if (await confirmAction(`Remover ${nome}?`)) {
      state.jogadores.splice(index, 1);
      localStorage.setItem("jogadores", JSON.stringify(state.jogadores));
      renderJogadores();
      showToast(`${nome} removido`, 'success');
    }
  }

  function renderJogadores() {
    const lista = document.getElementById('listaJogadores');
    const fragment = document.createDocumentFragment();
    
    state.jogadores.forEach((jogador, index) => {
      const li = document.createElement('li');
      
      const span = document.createElement('span');
      span.textContent = jogador;
      
      const button = document.createElement('button');
      button.textContent = '‚ùå';
      button.onclick = () => removerJogador(index);
      
      li.appendChild(span);
      li.appendChild(button);
      fragment.appendChild(li);
    });
    
    lista.innerHTML = '';
    lista.appendChild(fragment);
  }

  // ============================================
  // GEST√ÉO DE TIMES
  // ============================================

  function editarNomeTime(time) {
    state.timeEditando = time;
    document.getElementById('popupTituloNome').textContent = 
      `‚úèÔ∏è Editar Nome - ${time === 'A' ? state.nomeA : state.nomeB}`;
    
    const input = document.getElementById('inputNomeTime');
    input.value = time === 'A' ? state.nomeA : state.nomeB;
    
    document.getElementById('popupNomeTime').classList.add('show');
    setTimeout(() => input.focus(), 100);
  }

  function salvarNomeTime() {
    const input = document.getElementById('inputNomeTime');
    const nome = input.value.trim();
    
    if (!nome || nome.length > 20) {
      showToast('Nome inv√°lido (m√°x: 20 caracteres)', 'error');
      return;
    }
    
    if (state.timeEditando === 'A') {
      state.nomeA = nome;
      document.getElementById('nomeTimeA').textContent = nome;
      document.getElementById('nomeFaltaA').textContent = nome;
      localStorage.setItem("nomeTimeA", nome);
    } else {
      state.nomeB = nome;
      document.getElementById('nomeTimeB').textContent = nome;
      document.getElementById('nomeFaltaB').textContent = nome;
      localStorage.setItem("nomeTimeB", nome);
    }
    
    fecharPopupNome();
    if (navigator.vibrate) navigator.vibrate(10);
    showToast('Nome atualizado!', 'success');
  }

  function carregarNomesTimes() {
    state.nomeA = localStorage.getItem("nomeTimeA") || "Time A";
    state.nomeB = localStorage.getItem("nomeTimeB") || "Time B";
    
    document.getElementById('nomeTimeA').textContent = state.nomeA;
    document.getElementById('nomeTimeB').textContent = state.nomeB;
    document.getElementById('nomeFaltaA').textContent = state.nomeA;
    document.getElementById('nomeFaltaB').textContent = state.nomeB;
  }

  // ============================================
  // CONTROLE DO JOGO
  // ============================================

  async function iniciar() {
    if (state.partida) {
      if (!await confirmAction("J√° existe um jogo em andamento. Deseja iniciar um novo?")) {
        return;
      }
    }
    
    // Anima√ß√£o do bot√£o
    const btn = document.getElementById("btnIniciar");
    btn.classList.add("btn-animating-green");
    setTimeout(() => btn.classList.remove("btn-animating-green"), 600);
    
    // Resetar estado
    state.placar = { A: 0, B: 0 };
    state.faltas = { A: 0, B: 0 };
    state.historicaGols = [];
    state.historicaFaltas = [];
    state.ultimaAcao = null;
    state.segundos = 0;
    state.pausado = false;
    
    // Atualizar UI
    document.getElementById('placarA').textContent = '0';
    document.getElementById('placarB').textContent = '0';
    document.getElementById('faltasA').textContent = '0';
    document.getElementById('faltasB').textContent = '0';
    document.getElementById('listaGols').innerHTML = '';
    document.getElementById('tempo').textContent = '00:00';
    document.getElementById('tempo').classList.remove('tempo-pausado');
    document.getElementById('tituloGols').classList.remove('hidden');
    
    // Criar nova partida
    state.partida = {
      data: new Date().toLocaleString("pt-BR"),
      nomeTimes: { A: state.nomeA, B: state.nomeB }
    };
    
    // Iniciar cron√¥metro
    clearInterval(state.timer);
    state.timer = setInterval(() => {
      if (!state.pausado) {
        state.segundos++;
        const minutos = String(Math.floor(state.segundos / 60)).padStart(2, "0");
        const segundos = String(state.segundos % 60).padStart(2, "0");
        document.getElementById('tempo').textContent = `${minutos}:${segundos}`;
      }
    }, 1000);
    
    // Feedback
    mostrarOverlay("IN√çCIO DE JOGO", "‚öΩ", 1500);
    if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
    showToast('Jogo iniciado!', 'success');
  }

  function togglePause() {
    if (!state.partida) {
      showToast('Inicie um jogo primeiro!', 'error');
      return;
    }
    
    state.pausado = !state.pausado;
    
    if (state.pausado) {
      document.getElementById('tempo').classList.add('tempo-pausado');
      showToast('Jogo pausado', 'warning');
    } else {
      document.getElementById('tempo').classList.remove('tempo-pausado');
      showToast('Jogo retomado', 'success');
    }
    
    if (navigator.vibrate) navigator.vibrate(10);
  }

  async function resetar() {
    if (state.partida) {
      if (!await confirmAction("Resetar jogo atual? Todos os dados ser√£o perdidos.")) {
        return;
      }
    }
    
    // Parar cron√¥metro
    clearInterval(state.timer);
    
    // Resetar estado
    state.placar = { A: 0, B: 0 };
    state.faltas = { A: 0, B: 0 };
    state.historicaGols = [];
    state.historicaFaltas = [];
    state.ultimaAcao = null;
    state.partida = null;
    state.segundos = 0;
    state.pausado = false;
    
    // Resetar UI
    document.getElementById('placarA').textContent = '0';
    document.getElementById('placarB').textContent = '0';
    document.getElementById('faltasA').textContent = '0';
    document.getElementById('faltasB').textContent = '0';
    document.getElementById('listaGols').innerHTML = '';
    document.getElementById('tempo').textContent = '00:00';
    document.getElementById('tempo').classList.remove('tempo-pausado');
    document.getElementById('tituloGols').classList.add('hidden');
    
    esconderUndo();
    
    if (navigator.vibrate) navigator.vibrate(20);
    showToast('Jogo resetado', 'success');
  }

  async function fim() {
    if (!state.partida) {
      showToast('Inicie o jogo primeiro!', 'error');
      return;
    }
    
    // Anima√ß√£o do bot√£o
    const btn = document.getElementById("btnFim");
    btn.classList.add("btn-animating-red");
    setTimeout(() => btn.classList.remove("btn-animating-red"), 600);
    
    // Parar cron√¥metro
    clearInterval(state.timer);
    
    // Calcular estat√≠sticas da partida
    const golsPorJogador = {};
    state.historicaGols.forEach(gol => {
      if (!golsPorJogador[gol.jogador]) {
        golsPorJogador[gol.jogador] = { q: 0, t: gol.time };
      }
      golsPorJogador[gol.jogador].q++;
    });
    
    const faltasPorJogador = {};
    state.historicaFaltas.forEach(falta => {
      if (!faltasPorJogador[falta.jogador]) {
        faltasPorJogador[falta.jogador] = 0;
      }
      faltasPorJogador[falta.jogador]++;
    });
    
    // Completar dados da partida
    state.partida.placar = [state.placar.A, state.placar.B];
    state.partida.gols = golsPorJogador;
    state.partida.faltas = {
      A: state.faltas.A,
      B: state.faltas.B,
      jogadores: faltasPorJogador
    };
    state.partida.craque = calcularCraque(golsPorJogador);
    state.partida.duracao = state.segundos;
    
    // Salvar no hist√≥rico
    const historico = JSON.parse(localStorage.getItem("historico")) || [];
    historico.push(state.partida);
    localStorage.setItem("historico", JSON.stringify(historico));
    
    // Mostrar overlay e finalizar
    mostrarOverlay("FIM DE JOGO", "üèÜ", 2000, () => {
      const mensagem = `
        Jogo finalizado!
        
        ${state.nomeA} ${state.placar.A} √ó ${state.placar.B} ${state.nomeB}
        
        üèÜ Craque: ${state.partida.craque}
        
        ‚è±Ô∏è Dura√ß√£o: ${Math.floor(state.segundos / 60)}:${String(state.segundos % 60).padStart(2, '0')}
      `;
      
      alert(mensagem);
      resetar();
    });
    
    if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
  }

  // ============================================
  // FUN√á√ïES AUXILIARES DO JOGO
  // ============================================

  function mostrarOverlay(texto, icone, duracao, callback) {
    const overlay = document.getElementById("gameOverlay");
    document.getElementById("overlayText").textContent = texto;
    document.getElementById("overlayIcon").textContent = icone;
    
    overlay.classList.add("show");
    
    setTimeout(() => {
      overlay.classList.remove("show");
      if (callback) callback();
    }, duracao);
  }

  function calcularCraque(gols) {
    let craque = null;
    let maxGols = 0;
    
    Object.entries(gols).forEach(([jogador, dados]) => {
      if (dados.q > maxGols) {
        maxGols = dados.q;
        craque = jogador;
      }
    });
    
    return craque ? `${craque} (${maxGols})` : "‚Äî";
  }

  function animarGol() {
    const placarDiv = document.getElementById('placarDiv');
    placarDiv.classList.add("gol-animation");
    
    if (navigator.vibrate) {
      navigator.vibrate([100, 50, 100, 50, 100]);
    }
    
    setTimeout(() => {
      placarDiv.classList.remove("gol-animation");
    }, 600);
  }

  // ============================================
  // CONTROLE DE GOLS
  // ============================================

  function aumentarGol(time) {
    if (!state.partida) {
      showToast('Inicie o jogo primeiro!', 'error');
      return;
    }
    
    state.timeAtual = time;
    document.getElementById('popupTitulo').textContent = 
      `‚öΩ Gol do ${time === 'A' ? state.nomeA : state.nomeB}! Quem fez?`;
    
    // Obter ranking para ordenar jogadores
    const ranking = obterRankingGeral();
    
    // Ordenar jogadores por gols (mais gols primeiro)
    const jogadoresOrdenados = state.jogadores
      .map(jogador => ({ nome: jogador, gols: ranking[jogador] || 0 }))
      .sort((a, b) => b.gols - a.gols);
    
    // Renderizar bot√µes dos jogadores
    const popup = document.getElementById('popupJogadores');
    popup.innerHTML = '';
    
    jogadoresOrdenados.forEach(jogador => {
      const button = document.createElement('button');
      button.textContent = jogador.nome;
      button.onclick = () => registrarGol(jogador.nome);
      popup.appendChild(button);
    });
    
    // Mostrar popup
    document.getElementById('popupJogador').classList.add('show');
  }

  function registrarGol(jogador) {
    if (!state.timeAtual) return;
    
    // Registrar a√ß√£o para undo
    state.ultimaAcao = {
      tipo: "gol",
      time: state.timeAtual,
      jogador: jogador,
      index: state.historicaGols.length
    };
    
    mostrarUndo();
    
    // Atualizar placar
    if (state.timeAtual === 'A') {
      state.placar.A++;
    } else {
      state.placar.B++;
    }
    
    // Atualizar UI
    document.getElementById('placarA').textContent = state.placar.A;
    document.getElementById('placarB').textContent = state.placar.B;
    
    // Registrar gol
    state.historicaGols.push({
      time: state.timeAtual,
      jogador: jogador,
      minuto: Math.floor(state.segundos / 60),
      timestamp: Date.now()
    });
    
    // Atualizar lista de gols
    renderGols();
    
    // Animar e fechar popup
    animarGol();
    fecharPopup();
    
    // Feedback
    showToast(`Gol de ${jogador}!`, 'success');
  }

  function diminuirGol(time) {
    if (!state.partida) {
      showToast('Inicie o jogo primeiro!', 'error');
      return;
    }
    
    if ((time === 'A' && state.placar.A === 0) || (time === 'B' && state.placar.B === 0)) {
      showToast('N√£o h√° gols para remover', 'warning');
      return;
    }
    
    // Buscar √∫ltimos 3 gols do time
    const ultimosGols = state.historicaGols
      .map((gol, index) => ({ ...gol, index }))
      .filter(gol => gol.time === time)
      .slice(-3)
      .reverse();
    
    // Se n√£o houver gols registrados, remover do placar geral
    if (ultimosGols.length === 0) {
      if (time === 'A') {
        state.placar.A = Math.max(0, state.placar.A - 1);
      } else {
        state.placar.B = Math.max(0, state.placar.B - 1);
      }
      
      document.getElementById('placarA').textContent = state.placar.A;
      document.getElementById('placarB').textContent = state.placar.B;
      return;
    }
    
    // Mostrar popup para escolher qual gol remover
    const popup = document.getElementById('popupGols');
    popup.innerHTML = '';
    
    ultimosGols.forEach(gol => {
      const button = document.createElement('button');
      button.textContent = `${gol.jogador} - ${gol.minuto}min`;
      button.onclick = () => removerGolEspecifico(gol.index);
      popup.appendChild(button);
    });
    
    document.getElementById('popupRemover').classList.add('show');
  }

  function removerGolEspecifico(index) {
    const gol = state.historicaGols[index];
    
    // Atualizar placar
    if (gol.time === 'A') {
      state.placar.A = Math.max(0, state.placar.A - 1);
    } else {
      state.placar.B = Math.max(0, state.placar.B - 1);
    }
    
    // Atualizar UI
    document.getElementById('placarA').textContent = state.placar.A;
    document.getElementById('placarB').textContent = state.placar.B;
    
    // Remover gol
    state.historicaGols.splice(index, 1);
    
    // Atualizar lista
    renderGols();
    
    // Fechar popup e dar feedback
    fecharPopupRemover();
    if (navigator.vibrate) navigator.vibrate(15);
    showToast('Gol removido', 'warning');
  }

  function renderGols() {
    const lista = document.getElementById('listaGols');
    
    // Agrupar gols por jogador
    const golsPorJogador = {};
    state.historicaGols.forEach(gol => {
      if (!golsPorJogador[gol.jogador]) {
        golsPorJogador[gol.jogador] = 0;
      }
      golsPorJogador[gol.jogador]++;
    });
    
    // Criar lista ordenada (mais gols primeiro)
    const listaOrdenada = Object.entries(golsPorJogador)
      .sort((a, b) => b[1] - a[1]);
    
    // Renderizar usando fragment
    const fragment = document.createDocumentFragment();
    
    listaOrdenada.forEach(([jogador, quantidade]) => {
      const li = document.createElement('li');
      const span = document.createElement('span');
      span.textContent = `${jogador} ‚Äî ${quantidade} gol${quantidade > 1 ? 's' : ''}`;
      li.appendChild(span);
      fragment.appendChild(li);
    });
    
    lista.innerHTML = '';
    lista.appendChild(fragment);
  }

  // ============================================
  // CONTROLE DE FALTAS
  // ============================================

  function registrarFalta(time) {
    if (!state.partida) {
      showToast('Inicie o jogo primeiro!', 'error');
      return;
    }
    
    state.timeAtualFalta = time;
    document.getElementById('popupTituloFalta').textContent = 
      `‚ö†Ô∏è Falta do ${time === 'A' ? state.nomeA : state.nomeB}. Quem fez?`;
    
    // Obter ranking para ordenar
    const ranking = obterRankingGeral();
    
    // Ordenar jogadores
    const jogadoresOrdenados = state.jogadores
      .map(jogador => ({ nome: jogador, gols: ranking[jogador] || 0 }))
      .sort((a, b) => b.gols - a.gols);
    
    // Renderizar bot√µes
    const popup = document.getElementById('popupJogadoresFalta');
    popup.innerHTML = '';
    
    jogadoresOrdenados.forEach(jogador => {
      const button = document.createElement('button');
      button.textContent = jogador.nome;
      button.onclick = () => confirmarFalta(jogador.nome);
      popup.appendChild(button);
    });
    
    document.getElementById('popupFalta').classList.add('show');
  }

  function confirmarFalta(jogador) {
    if (!state.timeAtualFalta) return;
    
    // Registrar para undo
    state.ultimaAcao = {
      tipo: "falta",
      time: state.timeAtualFalta,
      jogador: jogador,
      index: state.historicaFaltas.length
    };
    
    mostrarUndo();
    
    // Atualizar faltas
    if (state.timeAtualFalta === 'A') {
      state.faltas.A++;
      document.getElementById('faltasA').textContent = state.faltas.A;
    } else {
      state.faltas.B++;
      document.getElementById('faltasB').textContent = state.faltas.B;
    }
    
    // Registrar falta
    state.historicaFaltas.push({
      time: state.timeAtualFalta,
      jogador: jogador,
      minuto: Math.floor(state.segundos / 60),
      timestamp: Date.now()
    });
    
    // Fechar popup e dar feedback
    fecharPopupFalta();
    if (navigator.vibrate) navigator.vibrate(10);
    showToast(`Falta de ${jogador}`, 'warning');
  }

  // ============================================
  // FUN√á√ÉO UNDO
  // ============================================

  function mostrarUndo() {
    const undoBtn = document.getElementById('undoBtn');
    undoBtn.style.display = 'block';
    
    // Limpar timer anterior
    clearTimeout(state.undoTimer);
    
    // Esconder ap√≥s 10 segundos (aumentado de 5)
    state.undoTimer = setTimeout(() => {
      esconderUndo();
    }, 10000);
  }

  function esconderUndo() {
    document.getElementById('undoBtn').style.display = 'none';
    state.ultimaAcao = null;
  }

  function desfazer() {
    if (!state.ultimaAcao) return;
    
    if (state.ultimaAcao.tipo === "gol") {
      // Desfazer gol
      if (state.ultimaAcao.time === 'A') {
        state.placar.A = Math.max(0, state.placar.A - 1);
      } else {
        state.placar.B = Math.max(0, state.placar.B - 1);
      }
      
      document.getElementById('placarA').textContent = state.placar.A;
      document.getElementById('placarB').textContent = state.placar.B;
      
      // Remover do hist√≥rico
      state.historicaGols.splice(state.ultimaAcao.index, 1);
      renderGols();
      
    } else if (state.ultimaAcao.tipo === "falta") {
      // Desfazer falta
      if (state.ultimaAcao.time === 'A') {
        state.faltas.A = Math.max(0, state.faltas.A - 1);
        document.getElementById('faltasA').textContent = state.faltas.A;
      } else {
        state.faltas.B = Math.max(0, state.faltas.B - 1);
        document.getElementById('faltasB').textContent = state.faltas.B;
      }
      
      // Remover do hist√≥rico
      state.historicaFaltas.splice(state.ultimaAcao.index, 1);
    }
    
    esconderUndo();
    if (navigator.vibrate) navigator.vibrate(15);
    showToast('A√ß√£o desfeita', 'success');
  }

  // ============================================
  // POPUPS
  // ============================================

  function fecharPopup(event) {
    if (event) event.stopPropagation();
    document.getElementById('popupJogador').classList.remove('show');
    state.timeAtual = null;
  }

  function fecharPopupFalta(event) {
    if (event) event.stopPropagation();
    document.getElementById('popupFalta').classList.remove('show');
    state.timeAtualFalta = null;
  }

  function fecharPopupRemover(event) {
    if (event) event.stopPropagation();
    document.getElementById('popupRemover').classList.remove('show');
  }

  function fecharPopupNome(event) {
    if (event) event.stopPropagation();
    document.getElementById('popupNomeTime').classList.remove('show');
    state.timeEditando = null;
  }

  // ============================================
  // RANKING E ESTAT√çSTICAS
  // ============================================

  function obterRankingGeral() {
    const historico = JSON.parse(localStorage.getItem("historico")) || [];
    const ranking = {};
    
    historico.forEach(partida => {
      Object.entries(partida.gols || {}).forEach(([jogador, dados]) => {
        ranking[jogador] = (ranking[jogador] || 0) + dados.q;
      });
    });
    
    return ranking;
  }

  function ranking() {
    const historico = JSON.parse(localStorage.getItem("historico")) || [];
    
    // Ranking Geral de Gols
    const rankingGeral = obterRankingGeral();
    const listaGeral = document.getElementById('listaRankingGeral');
    
    if (Object.keys(rankingGeral).length === 0) {
      listaGeral.innerHTML = '<li>Nenhum gol registrado ainda.</li>';
    } else {
      const fragment = document.createDocumentFragment();
      const rankingOrdenado = Object.entries(rankingGeral)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10); // Limitar a top 10
      
      rankingOrdenado.forEach(([jogador, gols], index) => {
        const li = document.createElement('li');
        
        const medalha = index === 0 ? 'ü•á' : 
                       index === 1 ? 'ü•à' : 
                       index === 2 ? 'ü•â' : `${index + 1}¬∫`;
        
        const spanNome = document.createElement('span');
        spanNome.textContent = `${medalha} ${jogador}`;
        
        const spanGols = document.createElement('span');
        spanGols.textContent = `${gols} gol${gols > 1 ? 's' : ''}`;
        
        li.appendChild(spanNome);
        li.appendChild(spanGols);
        fragment.appendChild(li);
      });
      
      listaGeral.innerHTML = '';
      listaGeral.appendChild(fragment);
    }
    
    // Ranking Mensal
    const hoje = new Date();
    const mesAtual = hoje.getMonth();
    const anoAtual = hoje.getFullYear();
    
    const partidasMes = historico.filter(partida => {
      try {
        const dataStr = partida.data.split(",")[0].trim();
        const [dia, mes, ano] = dataStr.split("/").map(Number);
        return (mes - 1) === mesAtual && ano === anoAtual;
      } catch {
        return false;
      }
    });
    
    const rankingMes = {};
    partidasMes.forEach(partida => {
      Object.entries(partida.gols || {}).forEach(([jogador, dados]) => {
        rankingMes[jogador] = (rankingMes[jogador] || 0) + dados.q;
      });
    });
    
    const listaMes = document.getElementById('listaRankingMes');
    
    if (Object.keys(rankingMes).length === 0) {
      listaMes.innerHTML = '<li>Sem partidas registradas neste m√™s.</li>';
    } else {
      const fragment = document.createDocumentFragment();
      const rankingOrdenado = Object.entries(rankingMes)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      
      rankingOrdenado.forEach(([jogador, gols], index) => {
        const li = document.createElement('li');
        
        const medalha = index === 0 ? 'ü•á' : 
                       index === 1 ? 'ü•à' : 
                       index === 2 ? 'ü•â' : `${index + 1}¬∫`;
        
        const spanNome = document.createElement('span');
        spanNome.textContent = `${medalha} ${jogador}`;
        
        const spanGols = document.createElement('span');
        spanGols.textContent = `${gols} gol${gols > 1 ? 's' : ''}`;
        
        li.appendChild(spanNome);
        li.appendChild(spanGols);
        fragment.appendChild(li);
      });
      
      listaMes.innerHTML = '';
      listaMes.appendChild(fragment);
    }
    
    // Ranking de Faltas
    const rankingFaltas = {};
    historico.forEach(partida => {
      if (partida.faltas && partida.faltas.jogadores) {
        Object.entries(partida.faltas.jogadores).forEach(([jogador, faltas]) => {
          rankingFaltas[jogador] = (rankingFaltas[jogador] || 0) + faltas;
        });
      }
    });
    
    const listaFaltas = document.getElementById('listaRankingFaltas');
    
    if (Object.keys(rankingFaltas).length === 0) {
      listaFaltas.innerHTML = '<li>Nenhuma falta registrada ainda.</li>';
    } else {
      const fragment = document.createDocumentFragment();
      const rankingOrdenado = Object.entries(rankingFaltas)
        .sort((a, b) => b[1] - a[1]);
      
      rankingOrdenado.forEach(([jogador, faltas]) => {
        const li = document.createElement('li');
        
        const spanNome = document.createElement('span');
        spanNome.textContent = jogador;
        
        const spanFaltas = document.createElement('span');
        spanFaltas.textContent = `${faltas} falta${faltas > 1 ? 's' : ''}`;
        
        li.appendChild(spanNome);
        li.appendChild(spanFaltas);
        fragment.appendChild(li);
      });
      
      listaFaltas.innerHTML = '';
      listaFaltas.appendChild(fragment);
    }
  }

  // ============================================
  // HIST√ìRICO
  // ============================================

  function historico() {
    const historico = JSON.parse(localStorage.getItem("historico")) || [];
    const lista = document.getElementById('listaHistorico');
    
    if (historico.length === 0) {
      lista.innerHTML = '<div class="card text-center"><p style="color:var(--text-sec)">Nenhuma partida registrada ainda</p></div>';
      return;
    }
    
    // Ordenar do mais recente para o mais antigo
    const historicoOrdenado = [...historico].reverse();
    const fragment = document.createDocumentFragment();
    
    historicoOrdenado.forEach(partida => {
      const times = partida.nomeTimes || { A: "Time A", B: "Time B" };
      const craque = partida.craque || "‚Äî";
      const placar = partida.placar || [0, 0];
      
      const item = document.createElement('div');
      item.className = 'historico-item';
      
      // Formatar dados dos gols
      let golsHTML = '';
      if (partida.gols) {
        golsHTML = Object.entries(partida.gols)
          .map(([jogador, dados]) => 
            `<div class="gol-item"><span>${escapeHTML(jogador)}</span><span>${dados.q} gol${dados.q > 1 ? 's' : ''}</span></div>`
          )
          .join('');
      }
      
      // Formatar dados das faltas
      let faltasHTML = '';
      if (partida.faltas && partida.faltas.jogadores) {
        faltasHTML = Object.entries(partida.faltas.jogadores)
          .map(([jogador, qtd]) => 
            `<div class="gol-item"><span>${escapeHTML(jogador)}</span><span>${qtd} falta${qtd > 1 ? 's' : ''}</span></div>`
          )
          .join('');
      }
      
      item.innerHTML = `
        <div class="historico-header">
          <span class="historico-data">${escapeHTML(partida.data)}</span>
          <span class="expand-icon">‚ñº</span>
        </div>
        <div class="historico-placar">
          <span>${escapeHTML(times.A)}</span>
          <span>${placar[0]}</span>
          <span class="vs">√ó</span>
          <span>${placar[1]}</span>
          <span>${escapeHTML(times.B)}</span>
        </div>
        <div class="historico-info">
          <span class="historico-craque">üèÜ <strong>${escapeHTML(craque)}</strong></span>
        </div>
        <div class="historico-details">
          <div class="historico-gols">
            <h5>‚öΩ Gols da Partida</h5>
            ${golsHTML || '<div class="gol-item"><span>Nenhum gol registrado</span></div>'}
          </div>
          ${faltasHTML ? `
            <div class="historico-gols" style="background:rgba(255,165,2,0.05);margin-top:8px;">
              <h5>‚ö†Ô∏è Faltas</h5>
              ${faltasHTML}
            </div>
          ` : ''}
        </div>
      `;
      
      // Adicionar evento de clique para expandir
      item.addEventListener('click', () => {
        item.classList.toggle('expanded');
        if (navigator.vibrate) navigator.vibrate(5);
      });
      
      fragment.appendChild(item);
    });
    
    lista.innerHTML = '';
    lista.appendChild(fragment);
  }

  async function limparHistorico() {
    if (await confirmAction("Apagar TODO o hist√≥rico? Esta a√ß√£o n√£o pode ser desfeita.")) {
      localStorage.removeItem("historico");
      historico();
      showToast('Hist√≥rico apagado!', 'success');
    }
  }

  // ============================================
  // ESTAT√çSTICAS
  // ============================================

  function estatisticas() {
    const historico = JSON.parse(localStorage.getItem("historico")) || [];
    
    // Estat√≠sticas Gerais
    const totalJogos = historico.length;
    let totalGols = 0;
    let totalFaltas = 0;
    
    historico.forEach(partida => {
      Object.values(partida.gols || {}).forEach(dados => {
        totalGols += dados.q;
      });
      
      if (partida.faltas) {
        totalFaltas += (partida.faltas.A || 0) + (partida.faltas.B || 0);
      }
    });
    
    const mediaGols = totalJogos > 0 ? (totalGols / totalJogos).toFixed(1) : '0';
    
    const statsGerais = document.getElementById('statsGerais');
    statsGerais.innerHTML = `
      <div class="stat-row">
        <span class="stat-label">Total de Jogos</span>
        <span class="stat-value">${totalJogos}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Total de Gols</span>
        <span class="stat-value">${totalGols}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">M√©dia de Gols/Jogo</span>
        <span class="stat-value">${mediaGols}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Total de Faltas</span>
        <span class="stat-value">${totalFaltas}</span>
      </div>
    `;
    
    // √öltimas 5 Partidas
    const ultimas5 = historico.slice(-5).reverse();
    const golsRecentes = {};
    
    ultimas5.forEach(partida => {
      Object.entries(partida.gols || {}).forEach(([jogador, dados]) => {
        golsRecentes[jogador] = (golsRecentes[jogador] || 0) + dados.q;
      });
    });
    
    const statsRecentes = document.getElementById('statsRecentes');
    
    if (Object.keys(golsRecentes).length === 0) {
      statsRecentes.innerHTML = '<p style="color:var(--text-sec);text-align:center">Nenhuma partida recente</p>';
    } else {
      const fragment = document.createDocumentFragment();
      const rankingRecentes = Object.entries(golsRecentes)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
      
      rankingRecentes.forEach(([jogador, gols]) => {
        const div = document.createElement('div');
        div.className = 'stat-row';
        
        const label = document.createElement('span');
        label.className = 'stat-label';
        label.textContent = jogador;
        
        const value = document.createElement('span');
        value.className = 'stat-value';
        value.innerHTML = `${gols} gol${gols > 1 ? 's' : ''} <span class="badge">üî•</span>`;
        
        div.appendChild(label);
        div.appendChild(value);
        fragment.appendChild(div);
      });
      
      statsRecentes.innerHTML = '';
      statsRecentes.appendChild(fragment);
    }
    
    // Estat√≠sticas por Jogador
    const statsPorJogador = {};
    
    state.jogadores.forEach(jogador => {
      let jogosComGols = 0;
      let totalGolsJogador = 0;
      let totalFaltasJogador = 0;
      let vitorias = 0;
      let derrotas = 0;
      let empates = 0;
      
      historico.forEach(partida => {
        const dadosGol = partida.gols && partida.gols[jogador];
        
        if (dadosGol) {
          jogosComGols++;
          totalGolsJogador += dadosGol.q;
          
          // Verificar resultado
          const placar = partida.placar;
          const timeJogador = dadosGol.t;
          const placarTime = placar[timeJogador === 'A' ? 0 : 1];
          const placarAdversario = placar[timeJogador === 'A' ? 1 : 0];
          
          if (placarTime > placarAdversario) {
            vitorias++;
          } else if (placarTime < placarAdversario) {
            derrotas++;
          } else {
            empates++;
          }
        }
        
        // Contar faltas
        if (partida.faltas && partida.faltas.jogadores) {
          totalFaltasJogador += partida.faltas.jogadores[jogador] || 0;
        }
      });
      
      if (jogosComGols > 0) {
        const media = (totalGolsJogador / jogosComGols).toFixed(1);
        const aproveitamento = Math.round((vitorias / jogosComGols) * 100);
        
        statsPorJogador[jogador] = {
          jogos: jogosComGols,
          gols: totalGolsJogador,
          faltas: totalFaltasJogador,
          vitorias: vitorias,
          derrotas: derrotas,
          empates: empates,
          media: media,
          aproveitamento: isNaN(aproveitamento) ? 0 : aproveitamento
        };
      }
    });
    
    const container = document.getElementById('statsPorJogador');
    container.innerHTML = '';
    
    if (Object.keys(statsPorJogador).length === 0) {
      container.innerHTML = '<p style="color:var(--text-sec);text-align:center">Nenhum jogador com estat√≠sticas</p>';
    } else {
      const fragment = document.createDocumentFragment();
      const ranking = Object.entries(statsPorJogador)
        .sort((a, b) => b[1].gols - a[1].gols);
      
      ranking.forEach(([jogador, stats]) => {
        const card = document.createElement('div');
        card.className = 'stat-card';
        
        card.innerHTML = `
          <h4>${escapeHTML(jogador)}</h4>
          <div class="stat-row">
            <span class="stat-label">Jogos</span>
            <span class="stat-value">${stats.jogos}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Gols</span>
            <span class="stat-value">${stats.gols} (${stats.media}/jogo)</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Aproveitamento</span>
            <span class="stat-value">
              ${stats.aproveitamento}% 
              <span class="badge ${stats.aproveitamento >= 60 ? '' : 'warning'}">
                ${stats.vitorias}V ${stats.empates}E ${stats.derrotas}D
              </span>
            </span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:${stats.aproveitamento}%"></div>
          </div>
          <div class="stat-row">
            <span class="stat-label">Faltas</span>
            <span class="stat-value">${stats.faltas}</span>
          </div>
        `;
        
        fragment.appendChild(card);
      });
      
      container.appendChild(fragment);
    }
    
    // Gerar gr√°fico
    gerarGrafico();
  }

  function gerarGrafico() {
    const historico = JSON.parse(localStorage.getItem("historico")) || [];
    const container = document.getElementById('graficoEvolucao');
    
    if (historico.length < 2) {
      container.innerHTML = '<p style="color:var(--text-sec);text-align:center">M√≠nimo de 2 partidas necess√°rio</p>';
      return;
    }
    
    // Obter top 3 jogadores
    const ranking = obterRankingGeral();
    const top3 = Object.entries(ranking)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 3);
    
    if (top3.length === 0) {
      container.innerHTML = '<p style="color:var(--text-sec);text-align:center">Sem dados</p>';
      return;
    }
    
    // Preparar dados
    const dados = {};
    top3.forEach(([jogador]) => {
      dados[jogador] = [];
      let acumulado = 0;
      
      historico.forEach(partida => {
        if (partida.gols && partida.gols[jogador]) {
          acumulado += partida.gols[jogador].q;
        }
        dados[jogador].push(acumulado);
      });
    });
    
    // Configura√ß√µes do gr√°fico
    const largura = Math.min(600, window.innerWidth - 60);
    const altura = 200;
    const margem = 40;
    const maxValor = Math.max(...Object.values(dados).flat());
    
    // Fun√ß√µes auxiliares
    const escalaY = (valor) => altura - margem - (valor / maxValor) * (altura - 2 * margem);
    const escalaX = (index, total) => margem + (index / (total - 1)) * (largura - 2 * margem);
    
    // Cores
    const cores = ["#0fb858", "#2196f3", "#ffa502"];
    
    // Criar SVG
    let svg = `<svg width="${largura}" height="${altura}" style="font-family:Arial;font-size:12px">`;
    
    // Linhas horizontais (grid)
    for (let i = 0; i <= maxValor; i += Math.ceil(maxValor / 5)) {
      const y = escalaY(i);
      svg += `<line x1="${margem}" y1="${y}" x2="${largura - 20}" y2="${y}" stroke="var(--border)" stroke-width="1"/>`;
      svg += `<text x="${margem - 10}" y="${y + 5}" text-anchor="end" fill="var(--text-sec)">${i}</text>`;
    }
    
    // Linhas dos jogadores
    top3.forEach(([jogador], index) => {
      const pontos = dados[jogador];
      let path = `M ${escalaX(0, pontos.length)} ${escalaY(pontos[0])}`;
      
      pontos.forEach((valor, idx) => {
        if (idx > 0) {
          path += ` L ${escalaX(idx, pontos.length)} ${escalaY(valor)}`;
        }
      });
      
      svg += `<path d="${path}" stroke="${cores[index]}" stroke-width="2" fill="none"/>`;
      
      // Pontos
      pontos.forEach((valor, idx) => {
        svg += `<circle cx="${escalaX(idx, pontos.length)}" cy="${escalaY(valor)}" r="4" fill="${cores[index]}"/>`;
      });
    });
    
    // Legenda
    top3.forEach(([jogador], index) => {
      svg += `<rect x="${largura - 150}" y="${20 + 20 * index}" width="15" height="3" fill="${cores[index]}"/>`;
      svg += `<text x="${largura - 130}" y="${25 + 20 * index}" fill="var(--text)">${jogador}</text>`;
    });
    
    svg += `</svg>`;
    container.innerHTML = svg;
  }

  // ============================================
  // COMPARA√á√ÉO
  // ============================================

  function carregarComparacao() {
    const select1 = document.getElementById('jogador1');
    const select2 = document.getElementById('jogador2');
    
    select1.innerHTML = '<option value="">Selecione jogador 1</option>';
    select2.innerHTML = '<option value="">Selecione jogador 2</option>';
    
    state.jogadores.forEach(jogador => {
      select1.innerHTML += `<option value="${escapeHTML(jogador)}">${escapeHTML(jogador)}</option>`;
      select2.innerHTML += `<option value="${escapeHTML(jogador)}">${escapeHTML(jogador)}</option>`;
    });
  }

  function compararJogadores() {
    const jogador1 = document.getElementById('jogador1').value;
    const jogador2 = document.getElementById('jogador2').value;
    const resultado = document.getElementById('resultadoComparacao');
    
    if (!jogador1 || !jogador2) {
      showToast('Selecione 2 jogadores', 'error');
      return;
    }
    
    if (jogador1 === jogador2) {
      showToast('Selecione jogadores diferentes', 'error');
      return;
    }
    
    const historico = JSON.parse(localStorage.getItem("historico")) || [];
    
    function calcularEstatisticas(nome) {
      let jogos = 0;
      let gols = 0;
      let faltas = 0;
      let vitorias = 0;
      
      historico.forEach(partida => {
        const dadosGol = partida.gols && partida.gols[nome];
        
        if (dadosGol) {
          jogos++;
          gols += dadosGol.q;
          
          // Verificar vit√≥ria
          const placar = partida.placar;
          const timeJogador = dadosGol.t;
          const placarTime = placar[timeJogador === 'A' ? 0 : 1];
          const placarAdversario = placar[timeJogador === 'A' ? 1 : 0];
          
          if (placarTime > placarAdversario) vitorias++;
        }
        
        // Contar faltas
        if (partida.faltas && partida.faltas.jogadores) {
          faltas += partida.faltas.jogadores[nome] || 0;
        }
      });
      
      return {
        jogos: jogos,
        gols: gols,
        faltas: faltas,
        media: jogos > 0 ? (gols / jogos).toFixed(1) : '0',
        aprov: jogos > 0 ? Math.round((vitorias / jogos) * 100) : 0
      };
    }
    
    const stats1 = calcularEstatisticas(jogador1);
    const stats2 = calcularEstatisticas(jogador2);
    
    resultado.innerHTML = `
      <div class="comparacao-container">
        <div class="jogador-compare">
          <h3>${escapeHTML(jogador1)}</h3>
          <div class="compare-stat">
            <div class="compare-stat-label">Gols</div>
            <div class="compare-stat-value" style="color:${stats1.gols >= stats2.gols ? 'var(--green)' : 'var(--text-sec)'}">
              ${stats1.gols}
            </div>
          </div>
          <div class="compare-stat">
            <div class="compare-stat-label">M√©dia</div>
            <div class="compare-stat-value" style="color:${parseFloat(stats1.media) >= parseFloat(stats2.media) ? 'var(--green)' : 'var(--text-sec)'}">
              ${stats1.media}
            </div>
          </div>
          <div class="compare-stat">
            <div class="compare-stat-label">Aproveitamento</div>
            <div class="compare-stat-value" style="color:${stats1.aprov >= stats2.aprov ? 'var(--green)' : 'var(--text-sec)'}">
              ${stats1.aprov}%
            </div>
          </div>
          <div class="compare-stat">
            <div class="compare-stat-label">Faltas</div>
            <div class="compare-stat-value" style="color:${stats1.faltas <= stats2.faltas ? 'var(--green)' : 'var(--yellow)'}">
              ${stats1.faltas}
            </div>
          </div>
        </div>
        <div class="compare-vs">VS</div>
        <div class="jogador-compare">
          <h3>${escapeHTML(jogador2)}</h3>
          <div class="compare-stat">
            <div class="compare-stat-label">Gols</div>
            <div class="compare-stat-value" style="color:${stats2.gols >= stats1.gols ? 'var(--green)' : 'var(--text-sec)'}">
              ${stats2.gols}
            </div>
          </div>
          <div class="compare-stat">
            <div class="compare-stat-label">M√©dia</div>
            <div class="compare-stat-value" style="color:${parseFloat(stats2.media) >= parseFloat(stats1.media) ? 'var(--green)' : 'var(--text-sec)'}">
              ${stats2.media}
            </div>
          </div>
          <div class="compare-stat">
            <div class="compare-stat-label">Aproveitamento</div>
            <div class="compare-stat-value" style="color:${stats2.aprov >= stats1.aprov ? 'var(--green)' : 'var(--text-sec)'}">
              ${stats2.aprov}%
            </div>
          </div>
          <div class="compare-stat">
            <div class="compare-stat-label">Faltas</div>
            <div class="compare-stat-value" style="color:${stats2.faltas <= stats1.faltas ? 'var(--green)' : 'var(--yellow)'}">
              ${stats2.faltas}
            </div>
          </div>
        </div>
      </div>
    `;
  }

  // ============================================
  // PWA E INSTALA√á√ÉO
  // ============================================

  function configurarPWA() {
    // Evento para capturar prompt de instala√ß√£o
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      state.deferredPrompt = e;
      
      // Mostrar bot√£o de instala√ß√£o
      const installBtn = document.getElementById('installBtn');
      installBtn.style.display = 'block';
      
      // Esconder ap√≥s 30 segundos
      setTimeout(() => {
        if (installBtn.style.display === 'block') {
          installBtn.style.display = 'none';
        }
      }, 30000);
    });
    
    // Evento quando o app √© instalado
    window.addEventListener('appinstalled', () => {
      console.log('PWA instalado!');
      document.getElementById('installBtn').style.display = 'none';
      state.deferredPrompt = null;
      showToast('App instalado com sucesso!', 'success');
    });
    
    // Verificar se j√° est√° instalado
    if (window.matchMedia('(display-mode: standalone)').matches) {
      document.getElementById('installBtn').style.display = 'none';
    }
  }

  function instalarApp() {
    if (state.deferredPrompt) {
      state.deferredPrompt.prompt();
      
      state.deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('Usu√°rio aceitou a instala√ß√£o');
          showToast('Instalando...', 'success');
        } else {
          console.log('Usu√°rio recusou a instala√ß√£o');
        }
        
        state.deferredPrompt = null;
        document.getElementById('installBtn').style.display = 'none';
      });
    } else {
      showToast('App j√° instalado ou navegador n√£o suporta', 'info');
    }
  }

  // ============================================
  // INICIALIZA√á√ÉO
  // ============================================

  function init() {
    // Carregar tema
    carregarTema();
    
    // Carregar nomes dos times
    carregarNomesTimes();
    
    // Renderizar jogadores
    renderJogadores();
    
    // Configurar PWA
    configurarPWA();
    
    // Registrar Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(() => console.log('Service Worker registrado com sucesso!'))
        .catch(err => console.log('Erro no Service Worker:', err));
    }
    
    console.log('PlacarApp inicializado com sucesso!');
  }

  // ============================================
  // API P√öBLICA
  // ============================================

  return {
    // Inicializa√ß√£o
    init: init,
    
    // Tema
    toggleTheme: toggleTheme,
    
    // Navega√ß√£o
    trocarTab: trocarTab,
    
    // Jogadores
    addJogador: addJogador,
    removerJogador: removerJogador,
    
    // Times
    editarNomeTime: editarNomeTime,
    salvarNomeTime: salvarNomeTime,
    
    // Jogo
    iniciar: iniciar,
    togglePause: togglePause,
    resetar: resetar,
    fim: fim,
    
    // Gols
    aumentarGol: aumentarGol,
    diminuirGol: diminuirGol,
    registrarGol: registrarGol,
    
    // Faltas
    registrarFalta: registrarFalta,
    confirmarFalta: confirmarFalta,
    
    // Undo
    desfazer: desfazer,
    
    // Popups
    fecharPopup: fecharPopup,
    fecharPopupFalta: fecharPopupFalta,
    fecharPopupRemover: fecharPopupRemover,
    fecharPopupNome: fecharPopupNome,
    
    // Hist√≥rico
    limparHistorico: limparHistorico,
    
    // Estat√≠sticas e Ranking
    ranking: ranking,
    historico: historico,
    estatisticas: estatisticas,
    compararJogadores: compararJogadores,
    carregarComparacao: carregarComparacao,
    
    // PWA
    instalarApp: instalarApp,
    
    // Estado (apenas leitura para debug)
    getState: () => ({ ...state })
  };
})();

// Inicializar quando o DOM estiver carregado
document.addEventListener('DOMContentLoaded', PlacarApp.init);
</script>
</body>
</html>